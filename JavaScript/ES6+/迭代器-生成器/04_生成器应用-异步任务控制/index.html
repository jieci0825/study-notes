<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    // åœ¨ es6 çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰ async å’Œ awaitã€‚async å’Œ await æ˜¯ es7
    // æ€ä¹ˆè§£å†³çš„é—®é¢˜å‘¢ï¼Ÿ

    // å¤§æ¦‚éœ€è¦å®ç°ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªç±»ä¼¼æ•ˆæœ
    /* 
      function* task() {
        yield 1
        const resp = yield fetch('http://101.132.72.36:5100/api/local')
        const result = yield resp.json()
      }
    */
    function* task() {
      yield 1
      const resp = yield fetch('http://s.coder-helper.coderjc.cn/api/front/about/author-info')
      const result = yield resp.json()
      // æ­¤æ—¶è¾“å‡ºå°±å¯ä»¥è¾¾åˆ°å’Œ async é…åˆ await ä¸€æ ·çš„æ•ˆæœäº†
      console.log("ğŸš¢ ~ å½“å‰æ‰“å°çš„å†…å®¹ ~ result:", result);
    }

    function run(generatorFunc) {
      const generator = generatorFunc()
      let result = generator.next() // å¯åŠ¨ä»»åŠ¡ï¼Œå¼€å§‹è¿­ä»£ï¼Œå¾—åˆ°è¿­ä»£æ•°æ®

      handleResult()

      // å¯¹ç»“æœè¿›è¡Œå¤„ç†
      function handleResult() {
        // æŸ¥é˜…è¿­ä»£æ˜¯å¦å®Œæˆ
        if (result.done) return

        // æ²¡æœ‰å®Œæˆçš„è¯ï¼Œæ£€æµ‹ç»“æœæ˜¯å¦æ˜¯ promise
        if (typeof result.value.then === 'function') {
          // è¿­ä»£çš„æ•°æ®æ˜¯ promiseï¼Œåˆ™ç­‰å¾… promise å®Œæˆåœ¨æ‰§è¡Œä¸‹ä¸€æ¬¡
          result.value.then(res => {
            result = generator.next(res)
            handleResult()
          }, err => {
            // æŠ›å‡ºé”™è¯¯
            result = generator.throw(err)
            handleResult()
          })
        } else {
          // æ˜¯å…¶ä»–æ•°æ®ï¼Œç›´æ¥è°ƒç”¨ä¸‹ä¸€æ¬¡å¾—åˆ°ç»“æœï¼Œè¿›è¡Œæ›´æ–°
          // console.log(result.value)
          result = generator.next(result.value)
          // å†æ¬¡è°ƒç”¨ handleResult å¤„ç†ç»“æœ
          handleResult()
        }
      }
    }

    run(task)
  </script>
</body>

</html>