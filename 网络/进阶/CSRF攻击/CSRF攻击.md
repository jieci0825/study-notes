# CSRF 攻击

## CSRF 攻击是什么

CSRF（Cross-site request forgery）跨站请求伪造

它是指攻击者利用用户的身份信息，执行了用户非本意的操作

<img src="http://cos.coderjc.cn/blog/image-20240417114538824.png" alt="image-20240417114538824" style="zoom:50%;" />

> 上述的流程表述的意思如下：
>
> 1. 用户登录了银行的站点
> 2. 登录成功，返回的响应结果携带token，并放在 set-cookie响应头里面
> 3. 浏览器把这个身份凭证的 cookie 存到浏览器
> 4. 突然用户在日常浏览其他网页的时候，看到一个**标题党的文章**，《青铜再喷，钻石在骂，而王者...》，点进去观看，实际这个是一个危险站点
> 5. 访问危险站点，就返回了响应，返回的响应就是一个img图片连接，因为这种连接浏览器不知道是什么，但是肯定会请求
> 6. 请求的时候因为也是 https://bank.com 这个网站，域名一致，会携带本地浏览器之前存储的 cookie
> 7. 因为接口参数正确，且携带了 cookie 的身份凭证，就会成功响应

这就上述的流程了，但是这个操作肯定不是用户的本意，就**执行了用户非本意的操作**，当然这里这个请求只是一个举例，如果伪造 post 请求就会使用 form 表单

## 防御方式

| 防御手段                  | 防御力 | 问题                                  |
| ------------------------- | ------ | ------------------------------------- |
| 不使用 cookie             | ⭐⭐⭐⭐⭐  | 兼容性差；ssr会遇到困难，但可以解决   |
| 使用 sameSite(响应头字段) | ⭐⭐⭐⭐   | 兼容性差；容易挡住自己人              |
| 使用 csrf token           | ⭐⭐⭐⭐⭐  | 获取到 token 后未进行操作仍然会被攻击 |
| 使用 referer 防护         | ⭐⭐     | 过去常用，现在已经被淘汰              |

